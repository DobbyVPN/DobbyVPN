# Lefthook — git hooks manager (runs linters before commit)

pre-commit:
  parallel: true
  commands:
    go-lint-unix:
      glob: "go_client/**/*.go"
      run: cd go_client && golangci-lint run --new.from-rev=HEAD~1 $(go list ./... | grep -v '_exports$')
      stage_fixed: true
      only:
        - os: linux
        - os: darwin

    go-lint-windows:
      glob: "go_client/**/*.go"
      run: cd go_client && powershell -Command "golangci-lint run --new.from-rev=HEAD~1 (go list ./... | Where-Object { $_ -notmatch '_exports$' })"
      stage_fixed: true
      only:
        - os: windows

    kotlin-detekt:
      glob: "kmp_client/**/*.kt"
      run: cd kmp_client && {gradlew} detekt
      # {gradlew} resolves to ./gradlew on Unix, gradlew.bat on Windows

    swift-lint:
      glob: "kmp_client/iosApp/**/*.swift"
      run: cd kmp_client/iosApp && swiftlint lint --config .swiftlint.yml --quiet
      # SwiftLint available on macOS only — skip silently on other OS
      only:
        - os: darwin
      fail_text: "SwiftLint found issues. Fix them before committing."

pre-push:
  commands:
    trufflehog:
      run: trufflehog git file://. --since-commit HEAD~5 --only-verified --fail
      fail_text: "TruffleHog detected secrets. Remove them before pushing."
